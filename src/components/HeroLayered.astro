---
import type { SiteContent } from "../data/content";
interface Props {
  hero: SiteContent["hero"];
}
const { hero } = Astro.props;
---

<section class="hero-l">
  <div class="hero-l__layers">
    <img
      src="/vonavky/hero-image/bg.jpg"
      alt=""
      class="hero-l__layer hero-l__layer--bg"
      loading="eager"
      decoding="async"
    />
    <img
      src="/vonavky/hero-image/reflection.png"
      alt=""
      class="hero-l__layer hero-l__layer--reflection"
      loading="eager"
      decoding="async"
    />
    <img
      src="/vonavky/hero-image/rose-l.png"
      alt=""
      class="hero-l__layer hero-l__layer--rose-l"
      loading="eager"
      decoding="async"
    />
    <img
      src="/vonavky/hero-image/rose-r.png"
      alt=""
      class="hero-l__layer hero-l__layer--rose-r"
      loading="eager"
      decoding="async"
    />
    <img
      src="/vonavky/hero-image/parfume.png"
      alt={hero.imgAlt}
      class="hero-l__layer hero-l__layer--parfume"
      loading="eager"
      decoding="async"
    />
  </div>

  <div class="hero-l__overlay"></div>

  <div class="hero-l__content">
    <span class="hero-l__preheadline">{hero.preheadline}</span>
    <h1 class="hero-l__title">{hero.title}</h1>
    <p class="hero-l__subtitle" set:html={hero.subtitle} />
    <a href="#value" class="btn-gold hero-l__cta">{hero.cta}</a>
  </div>

  <div class="hero-l__glow"></div>
  <div class="hero-l__particles" aria-hidden="true"></div>

  <div class="hero-l__scroll-hint" aria-hidden="true">
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
    >
      <path d="M12 5v14M5 12l7 7 7-7"></path>
    </svg>
  </div>
</section>

<style>
  /* ========================================
     Hero Layered – Base (mobile-first)
     ======================================== */
  .hero-l {
    min-height: 100svh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    text-align: center;
    position: relative;
    overflow: hidden;
    background: var(--color-bg-primary);
  }

  /* ---- Layer stack ---- */
  .hero-l__layers {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 0;
    /* On mobile, zoom in by making it wider than viewport */
    width: 160%;
    left: 50%;
    transform: translateX(-50%);
    aspect-ratio: 1410 / 1182;
  }

  .hero-l__layer {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: bottom center;
    opacity: 0;
    will-change: opacity, transform;
  }

  /* ---- Layer animations ---- */

  /* 1) Background – quick fade */
  .hero-l__layer--bg {
    object-fit: cover;
    animation: layerFade 0.6s ease forwards;
    animation-delay: 0.1s;
  }

  /* 2) Roses – fade from center */
  .hero-l__layer--rose-l {
    animation: layerFadeRight 0.9s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    animation-delay: 0.3s;
  }

  .hero-l__layer--rose-r {
    animation: layerFadeLeft 0.9s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    animation-delay: 0.3s;
  }

  /* 3) Reflection + Parfume – together */
  .hero-l__layer--reflection {
    animation: layerFade 1s ease forwards;
    animation-delay: 0.6s;
  }

  .hero-l__layer--parfume {
    animation: layerFadeUp 1s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    animation-delay: 0.6s;
  }

  /* ---- Keyframes ---- */
  @keyframes layerFade {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes layerFadeUp {
    from {
      opacity: 0;
      transform: translateY(40px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes layerFadeLeft {
    from {
      opacity: 0;
      transform: translateX(-40px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes layerFadeRight {
    from {
      opacity: 0;
      transform: translateX(40px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* ---- Golden glow ---- */
  .hero-l__glow {
    position: absolute;
    bottom: 20%;
    left: 50%;
    width: 600px;
    height: 600px;
    margin-left: -300px;
    background: radial-gradient(
      circle,
      rgba(212, 168, 67, 0.25) 0%,
      rgba(212, 168, 67, 0.1) 35%,
      transparent 65%
    );
    z-index: 2;
    pointer-events: none;
    animation: glowAppear 2s ease forwards;
    animation-delay: 0.8s;
    opacity: 0;
  }

  @keyframes glowAppear {
    0% { opacity: 0; }
    100% { opacity: 1; }
  }

  @keyframes glowBreath {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.12); opacity: 0.75; }
  }

  /* ---- Particles ---- */
  .hero-l__particles {
    position: absolute;
    inset: 0;
    z-index: 2;
    pointer-events: none;
    overflow: hidden;
  }

  :global(.hero-l__particle) {
    position: absolute;
    border-radius: 50%;
    background: rgba(212, 168, 67, var(--p-opacity, 0.5));
    box-shadow: 0 0 6px 2px rgba(212, 168, 67, calc(var(--p-opacity, 0.5) * 0.5));
    animation: particleFloatL var(--p-dur, 18s) ease-in-out infinite;
    animation-delay: var(--p-delay, 0s);
    will-change: transform, opacity;
  }

  @keyframes particleFloatL {
    0% {
      transform: translate(0, 0) scale(1);
      opacity: var(--p-opacity, 0.5);
    }
    25% {
      transform: translate(var(--p-dx1, 20px), var(--p-dy1, -50px)) scale(1.3);
      opacity: calc(var(--p-opacity, 0.5) * 1.5);
    }
    50% {
      transform: translate(var(--p-dx2, -15px), var(--p-dy2, -100px)) scale(0.7);
      opacity: var(--p-opacity, 0.5);
    }
    75% {
      transform: translate(var(--p-dx3, 10px), var(--p-dy3, -40px)) scale(1.2);
      opacity: calc(var(--p-opacity, 0.5) * 0.8);
    }
    100% {
      transform: translate(0, 0) scale(1);
      opacity: var(--p-opacity, 0.5);
    }
  }

  /* ---- Dark overlay for text readability ---- */
  .hero-l__overlay {
    position: absolute;
    inset: 0;
    z-index: 1;
    background: linear-gradient(
      to bottom,
      var(--color-bg-primary) 0%,
      rgba(8, 8, 8, 0.7) 15%,
      rgba(8, 8, 8, 0.2) 40%,
      rgba(8, 8, 8, 0.05) 55%,
      rgba(8, 8, 8, 0.4) 100%
    );
    pointer-events: none;
  }

  /* ---- Content ---- */
  .hero-l__content {
    position: relative;
    z-index: 3;
    max-width: 700px;
    padding: var(--space-lg);
    padding-top: clamp(3rem, 12vh, 8rem);
  }

  .hero-l__preheadline {
    display: inline-block;
    font-family: var(--font-body);
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 0.35em;
    text-transform: uppercase;
    background: linear-gradient(
      90deg,
      var(--color-gold-dark) 0%,
      var(--color-gold-light) 40%,
      var(--color-gold) 60%,
      var(--color-gold-dark) 100%
    );
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation:
      fadeInUp 0.8s ease forwards,
      shimmer 3s ease-in-out infinite;
    animation-delay: 1s, 0s;
    opacity: 0;
    margin-bottom: 1.5rem;
  }

  .hero-l__title {
    font-size: clamp(2.2rem, 9vw, 5.5rem);
    color: var(--color-text-primary);
    margin-bottom: var(--space-sm);
    opacity: 0;
    text-shadow: 0 2px 30px rgba(0, 0, 0, 0.6);
  }

  .hero-l__title:not(.hero-l__title--split) {
    animation: fadeInUp 0.8s ease forwards;
    animation-delay: 1.15s;
  }

  :global(.hero-l__title-char) {
    display: inline-block;
    opacity: 0;
    animation: charRevealL 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  @keyframes charRevealL {
    0% {
      opacity: 0;
      transform: translateY(40px);
      filter: blur(4px);
    }
    60% {
      filter: blur(0);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
    }
  }

  .hero-l__subtitle {
    font-size: clamp(0.9rem, 3.5vw, 1.5rem);
    color: var(--color-text-primary);
    margin-bottom: var(--space-lg);
    line-height: 1.6;
    animation: fadeInUp 0.8s ease forwards;
    animation-delay: 1.3s;
    opacity: 0;
    max-width: 560px;
    margin-left: auto;
    margin-right: auto;
    text-shadow: 0 1px 8px rgba(0, 0, 0, 0.5);
  }

  .hero-l__cta {
    animation: fadeInUp 0.8s ease forwards;
    animation-delay: 1.45s;
    opacity: 0;
    font-size: 1rem;
    padding: 0.85rem 2.5rem;
    position: relative;
    z-index: 3;
    box-shadow:
      0 10px 30px rgba(0, 0, 0, 0.5),
      0 4px 12px rgba(0, 0, 0, 0.3);
  }

  .hero-l__scroll-hint {
    position: absolute;
    bottom: var(--space-lg);
    color: var(--color-gold);
    z-index: 2;
    animation: fadeInUp 0.8s ease forwards;
    animation-delay: 1.8s;
    opacity: 0;
  }

  .hero-l__scroll-hint svg {
    animation: floatL 2s ease-in-out infinite;
  }

  @keyframes floatL {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(8px);
    }
  }

  /* ========================================
     Small phones (≤ 380px) – extra zoom
     ======================================== */
  @media (max-width: 380px) {
    .hero-l__layers {
      width: 200%;
    }

    .hero-l__content {
      padding-top: clamp(2.5rem, 10vh, 5rem);
    }

    .hero-l__preheadline {
      font-size: 0.7rem;
      margin-bottom: 1rem;
    }
  }

  /* ========================================
     Landscape phones
     ======================================== */
  @media (max-height: 500px) and (orientation: landscape) {
    .hero-l {
      min-height: 100svh;
    }

    .hero-l__layers {
      width: auto;
      height: 100%;
      aspect-ratio: auto;
      bottom: 0;
      top: 0;
    }

    .hero-l__layer {
      object-fit: cover;
    }

    .hero-l__content {
      padding-top: 1.5rem;
    }

    .hero-l__preheadline {
      margin-bottom: 0.5rem;
    }

    .hero-l__subtitle {
      margin-bottom: var(--space-md);
    }
  }

  /* ========================================
     Tablet (≥ 600px)
     ======================================== */
  @media (min-width: 600px) {
    .hero-l__layers {
      width: 130%;
      max-width: none;
    }

    .hero-l__content {
      padding-top: clamp(3rem, 10vh, 7rem);
    }

    .hero-l__preheadline {
      font-size: 0.85rem;
      margin-bottom: 2rem;
    }

    .hero-l__overlay {
      background: linear-gradient(
        to bottom,
        var(--color-bg-primary) 0%,
        rgba(8, 8, 8, 0.65) 15%,
        rgba(8, 8, 8, 0.15) 45%,
        rgba(8, 8, 8, 0.05) 55%,
        rgba(8, 8, 8, 0.4) 100%
      );
    }
  }

  /* ========================================
     Tablet landscape / small desktop (≥ 768px)
     ======================================== */
  @media (min-width: 768px) {
    .hero-l__layers {
      width: 110%;
      max-width: none;
    }

    .hero-l__preheadline {
      margin-bottom: 2.5rem;
    }
  }

  /* ========================================
     Desktop (≥ 1024px) – image right, content left
     ======================================== */
  @media (min-width: 1024px) {
    .hero-l {
      justify-content: center;
      align-items: flex-start;
      text-align: left;
    }

    .hero-l__layers {
      /* Anchor right, natural aspect ratio */
      width: auto;
      height: 100%;
      max-width: none;
      left: auto;
      right: 0;
      transform: none;
      aspect-ratio: 1410 / 1182;
    }

    .hero-l__content {
      padding: var(--space-lg) 5% var(--space-lg) 12%;
      padding-top: 0;
      max-width: 55%;
    }

    .hero-l__subtitle {
      margin-left: 0;
      margin-right: 0;
      margin-bottom: var(--space-lg);
    }

    .hero-l__preheadline {
      font-size: 1rem;
      margin-bottom: var(--space-md);
    }

    .hero-l__title {
      margin-bottom: var(--space-sm);
    }

    .hero-l__cta {
      font-size: 1.2rem;
      padding: 1.2rem 3.5rem;
    }

    .hero-l__overlay {
      background:
        /* top-bottom: fade from bg */
        linear-gradient(
          to bottom,
          var(--color-bg-primary) 0%,
          transparent 20%,
          transparent 85%,
          rgba(8, 8, 8, 0.6) 100%
        ),
        /* left-right: smooth fade from bg into image */
          linear-gradient(
            to right,
            var(--color-bg-primary) 47%,
            rgba(8, 8, 8, 0.9) 51%,
            rgba(8, 8, 8, 0.6) 55%,
            rgba(8, 8, 8, 0.25) 62%,
            transparent 76%
          );
    }

    .hero-l__glow {
      left: 65%;
      margin-left: -350px;
      bottom: 30%;
      width: 700px;
      height: 700px;
    }

    .hero-l__scroll-hint {
      left: 5%;
    }
  }
</style>

<script>
  const prefersReducedMotion = window.matchMedia(
    "(prefers-reduced-motion: reduce)",
  ).matches;

  const hero = document.querySelector(".hero-l") as HTMLElement;
  if (hero) {
    const title = hero.querySelector(".hero-l__title") as HTMLElement;

    // Character-by-character reveal
    if (!prefersReducedMotion && title) {
      const text = title.textContent || "";
      title.innerHTML = "";
      title.classList.add("hero-l__title--split");
      title.style.opacity = "1";

      text.split("").forEach((char, i) => {
        const span = document.createElement("span");
        span.textContent = char === " " ? "\u00A0" : char;
        span.className = "hero-l__title-char";
        span.style.animationDelay = `${1.15 + i * 0.035}s`;
        title.appendChild(span);
      });
    }

    // Golden particles
    if (!prefersReducedMotion) {
      const container = hero.querySelector(".hero-l__particles") as HTMLElement;
      const COUNT = 50;

      for (let i = 0; i < COUNT; i++) {
        const dot = document.createElement("div");
        dot.className = "hero-l__particle";

        const size = 1.5 + Math.random() * 4;
        const x = 5 + Math.random() * 92;
        const y = 10 + Math.random() * 85;
        const opacity = 0.3 + Math.random() * 0.5;
        const duration = 14 + Math.random() * 12;
        const delay = -(Math.random() * duration);

        const dx1 = (Math.random() - 0.5) * 70;
        const dy1 = -20 - Math.random() * 70;
        const dx2 = (Math.random() - 0.5) * 50;
        const dy2 = -50 - Math.random() * 80;
        const dx3 = (Math.random() - 0.5) * 60;
        const dy3 = -15 - Math.random() * 50;

        dot.style.cssText = `
          width:${size}px;height:${size}px;
          left:${x}%;top:${y}%;
          --p-opacity:${opacity};--p-dur:${duration}s;--p-delay:${delay}s;
          --p-dx1:${dx1}px;--p-dy1:${dy1}px;
          --p-dx2:${dx2}px;--p-dy2:${dy2}px;
          --p-dx3:${dx3}px;--p-dy3:${dy3}px;
        `;
        container.appendChild(dot);
      }
    }

    // Shared glow scale state
    let glowScale = 1;

    // Glow breathing via JS (Astro scopes keyframe names)
    const glow = hero.querySelector(".hero-l__glow") as HTMLElement;
    if (glow && !prefersReducedMotion) {
      let glowDir = 1;
      glow.addEventListener("animationend", () => {
        glow.style.opacity = "1";
        glow.style.animation = "none";
        const breathe = () => {
          glowScale += glowDir * 0.0008;
          if (glowScale > 1.12) glowDir = -1;
          if (glowScale < 1) glowDir = 1;
          // Only set transform when no parallax is running
          if (!parallaxActive) {
            glow.style.transform = `scale(${glowScale})`;
          }
          requestAnimationFrame(breathe);
        };
        breathe();
      }, { once: true });
    }

    // Mouse parallax – desktop only
    const isTouchDevice =
      "ontouchstart" in window || navigator.maxTouchPoints > 0;
    const isDesktop = window.innerWidth >= 1024;
    let parallaxActive = false;

    if (!prefersReducedMotion && !isTouchDevice && isDesktop) {
      parallaxActive = true;
      const layers = hero.querySelector(".hero-l__layers") as HTMLElement;
      const content = hero.querySelector(".hero-l__content") as HTMLElement;

      let mouseX = 0;
      let mouseY = 0;
      let targetX = 0;
      let targetY = 0;
      let animId: number;
      const LERP = 0.06;

      hero.addEventListener(
        "mousemove",
        (e: MouseEvent) => {
          const rect = hero.getBoundingClientRect();
          targetX = (e.clientX - rect.left) / rect.width - 0.5;
          targetY = (e.clientY - rect.top) / rect.height - 0.5;
        },
        { passive: true },
      );

      hero.addEventListener(
        "mouseleave",
        () => {
          targetX = 0;
          targetY = 0;
        },
        { passive: true },
      );

      function animate() {
        mouseX += (targetX - mouseX) * LERP;
        mouseY += (targetY - mouseY) * LERP;

        layers.style.transform = `translate3d(${mouseX * 25}px, ${mouseY * 15}px, 0)`;
        content.style.transform = `translate3d(${mouseX * -10}px, ${mouseY * -8}px, 0)`;

        if (glow) {
          glow.style.transform = `scale(${glowScale}) translate3d(${mouseX * 40}px, ${mouseY * 30}px, 0)`;
        }

        animId = requestAnimationFrame(animate);
      }

      animate();

      document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
          cancelAnimationFrame(animId);
        } else {
          animate();
        }
      });
    }
  }
</script>
