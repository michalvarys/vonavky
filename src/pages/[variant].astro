---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import HeroLayered from '../components/HeroLayered.astro';
import HeroSpray from '../components/HeroSpray.astro';
import Story from '../components/Story.astro';
import ValueProposition from '../components/ValueProposition.astro';
import Offer from '../components/Offer.astro';
import WaitlistForm from '../components/WaitlistForm.astro';
import Footer from '../components/Footer.astro';

import type { SiteContent } from '../data/content';

export function getStaticPaths() {
  const modules = import.meta.glob<{ content: SiteContent }>(
    '../data/variants/*.ts',
    { eager: true },
  );

  return Object.entries(modules).map(([path, mod]) => {
    const slug = path.split('/').pop()!.replace('.ts', '');
    return { params: { variant: slug }, props: { content: mod.content } };
  });
}

interface Props { content: SiteContent }
const { content } = Astro.props;
const { variant } = Astro.params;

const sections = content.sections.filter(s => s.active !== false);
---

<Layout title={content.meta.title} description={content.meta.description}>
  {sections.map(s => {
    if (s.name === 'hero') {
      return content.heroVariant === 'layered'
        ? <HeroLayered hero={content.hero} />
        : content.heroVariant === 'spray'
        ? <HeroSpray hero={content.hero} />
        : <Hero hero={content.hero} />;
    }
    if (s.name === 'value') return <ValueProposition value={content.value} />;
    if (s.name === 'offer') return <Offer offer={content.offer} />;
    if (s.name === 'story') return <Story story={content.story} />;
    if (s.name === 'waitlist') return <WaitlistForm waitlist={content.waitlist} variant={variant} />;
    if (s.name === 'footer') return <Footer footer={content.footer} />;
  })}
</Layout>
